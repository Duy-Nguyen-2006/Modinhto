<!DOCTYPE html>
<html lang="en" class="bg-slate-950 text-slate-100">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Crawler</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.3/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-top: 4px solid #38bdf8;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="border-b border-slate-800 bg-slate-900/70 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 py-4 flex flex-col md:flex-row md:items-center gap-3">
      <div class="flex items-center gap-2">
        <div class="h-10 w-10 rounded-full bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center font-black text-slate-950">VC</div>
        <div>
          <div class="text-lg font-bold">Video Crawler</div>
          <div class="text-xs text-slate-400">Tìm kiếm video theo diễn viên</div>
        </div>
      </div>
      <div class="flex-1 flex gap-2">
        <input id="searchInput" type="text" placeholder="Nhập tên diễn viên..." class="w-full rounded-lg bg-slate-800 border border-slate-700 px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-400" />
        <button id="searchBtn" class="px-4 py-2 rounded-lg bg-gradient-to-r from-cyan-400 to-blue-500 text-slate-950 font-semibold hover:from-cyan-300 hover:to-blue-400 transition">Search</button>
      </div>
    </div>
  </header>

  <main class="flex-1 max-w-6xl mx-auto w-full px-4 py-6">
    <section id="statusArea" class="hidden items-center justify-center py-12">
      <div class="spinner"></div>
    </section>

    <section id="homeGrid" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></section>
    <section id="detailList" class="hidden">
      <div class="flex items-center justify-between mb-4">
        <h2 id="detailTitle" class="text-xl font-bold"></h2>
        <button id="backBtn" class="text-sm text-cyan-300 hover:text-cyan-200">← Quay lại trang chủ</button>
      </div>
      <div id="detailContent" class="space-y-3"></div>
    </section>

    <section id="emptyState" class="hidden text-center py-12 text-slate-400">
      Không tìm thấy kết quả hoặc có lỗi kết nối.
    </section>
  </main>

  <script>
    const homeGrid = document.getElementById('homeGrid');
    const detailList = document.getElementById('detailList');
    const detailTitle = document.getElementById('detailTitle');
    const detailContent = document.getElementById('detailContent');
    const statusArea = document.getElementById('statusArea');
    const emptyState = document.getElementById('emptyState');
    const backBtn = document.getElementById('backBtn');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');

    const API_HOME = '/api/home';
    const API_SEARCH = '/api/search?actor=';

    function showLoading() {
      statusArea.classList.remove('hidden');
      statusArea.classList.add('flex');
      emptyState.classList.add('hidden');
    }
    function hideLoading() {
      statusArea.classList.add('hidden');
      statusArea.classList.remove('flex');
    }
    function showEmpty() {
      emptyState.classList.remove('hidden');
    }
    function hideEmpty() {
      emptyState.classList.add('hidden');
    }

    function renderHome(actors) {
      detailList.classList.add('hidden');
      homeGrid.classList.remove('hidden');
      homeGrid.innerHTML = '';
      actors.forEach(({ actor, videos }) => {
        const card = document.createElement('div');
        card.className = 'rounded-xl border border-slate-800 bg-slate-900/60 p-4 shadow-lg shadow-slate-900/40 flex flex-col gap-3';
        const title = document.createElement('button');
        title.className = 'text-lg font-bold text-left text-cyan-300 hover:text-cyan-200';
        title.textContent = actor.name;
        title.onclick = () => searchActor(actor.name);
        const list = document.createElement('div');
        list.className = 'space-y-2';
        videos.forEach(v => {
          const item = document.createElement('a');
          item.href = v.link;
          item.target = '_blank';
          item.rel = 'noopener';
          item.className = 'block text-sm text-slate-200 hover:text-cyan-200 truncate';
          item.textContent = `• ${v.title}`;
          list.appendChild(item);
        });
        const more = document.createElement('button');
        more.className = 'text-sm text-cyan-300 hover:text-cyan-200';
        more.textContent = 'Xem thêm →';
        more.onclick = () => searchActor(actor.name);
        card.appendChild(title);
        card.appendChild(list);
        card.appendChild(more);
        homeGrid.appendChild(card);
      });
    }

    function renderDetail(actorName, videos) {
      homeGrid.classList.add('hidden');
      detailList.classList.remove('hidden');
      detailTitle.textContent = `Kết quả: ${actorName} (${videos.length})`;
      detailContent.innerHTML = '';
      videos.forEach(v => {
        const row = document.createElement('div');
        row.className = 'rounded-lg border border-slate-800 bg-slate-900/60 p-3 flex flex-col gap-1';
        const title = document.createElement('div');
        title.className = 'font-semibold text-slate-100';
        title.textContent = v.title;
        const meta = document.createElement('div');
        meta.className = 'text-xs text-slate-400';
        meta.textContent = `Source: ${v.source}`;
        const link = document.createElement('a');
        link.href = v.link;
        link.target = '_blank';
        link.rel = 'noopener';
        link.className = 'inline-flex w-fit mt-1 px-3 py-1 rounded-md bg-cyan-500 text-slate-950 text-sm font-semibold hover:bg-cyan-400 transition';
        link.textContent = 'Xem ngay';
        row.appendChild(title);
        row.appendChild(meta);
        row.appendChild(link);
        detailContent.appendChild(row);
      });
      if (!videos.length) showEmpty(); else hideEmpty();
    }

    async function fetchJSON(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Network response was not ok');
      return res.json();
    }

    async function loadHome() {
      showLoading();
      try {
        hideEmpty();
        const data = await fetchJSON(API_HOME);
        renderHome(data);
      } catch (e) {
        showEmpty();
        console.error(e);
      } finally {
        hideLoading();
      }
    }

    async function searchActor(actorName) {
      showLoading();
      try {
        hideEmpty();
        const data = await fetchJSON(API_SEARCH + encodeURIComponent(actorName));
        renderDetail(actorName, data.results || []);
      } catch (e) {
        showEmpty();
        console.error(e);
      } finally {
        hideLoading();
      }
    }

    searchBtn.addEventListener('click', () => {
      const name = searchInput.value.trim();
      if (name) searchActor(name);
    });
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const name = searchInput.value.trim();
        if (name) searchActor(name);
      }
    });
    backBtn.addEventListener('click', () => {
      hideEmpty();
      detailList.classList.add('hidden');
      homeGrid.classList.remove('hidden');
    });

    loadHome();
  </script>
</body>
</html>
